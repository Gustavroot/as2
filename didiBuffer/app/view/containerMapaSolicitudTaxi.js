/*
 * File: app/view/containerMapaSolicitudTaxi.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.1.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.containerMapaSolicitudTaxi', {
    extend: 'Ext.Container',
    alias: 'widget.containermapasolicitudtaxi',

    requires: [
        'MyApp.view.mapaSolicitudTaxi'
    ],

    config: {
        id: 'containerMapaSolicitudTaxi',
        layout: {
            type: 'fit'
        },
        listeners: [
            {
                fn: 'onContainerInitialize',
                event: 'initialize'
            }
        ],
        items: [
            {
                xtype: 'mapaSolicitudTaxi'
            },
            {
                xtype: 'container',
                border: 0,
                bottom: '10%',
                height: '10%',
                id: 'containerBotonVolverPosActual',
                left: '40%',
                style: 'background: transparent',
                width: '20%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con este codigo se permite que el mapa se vuelva a centrar en la posicion
                            //actual propia
                            if (navigator.geolocation) {
                                navigator.geolocation.getCurrentPosition(
                                function(position){
                                    //Se crea un objeto de posicion, con latitud y longitud actuales
                                    posActual = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                                    Ext.getCmp("mapaSolicitudTaxi").setMapCenter({latitude: posActual.lat(), longitude: posActual.lng()});
                                }
                                );
                            }

                        },
                        height: '100%',
                        id: 'botonVolverPoActual',
                        ui: 'confirm-round',
                        width: '100%',
                        iconCls: 'locate',
                        iconMask: true
                    }
                ]
            },
            {
                xtype: 'container',
                border: 0,
                bottom: '10%',
                height: '10%',
                id: 'containerBotonEnviarSolicitud',
                left: '70%',
                style: 'background: transparent',
                width: '20%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            try{
                                //Se extraen la latitud y longitud originales
                                latitudeParaPeticion=markerPosActualDidiTaxi.getPosition().lat();
                                longitudeParaPeticion=markerPosActualDidiTaxi.getPosition().lng();
                                var variableSePudoObtenerUbicacionDelPedidor=1;
                            }
                            catch(e){
                                var variableSePudoObtenerUbicacionDelPedidor=0;
                                Ext.Msg.alert('Aviso', 'No se pudo obtener su ubicación.', Ext.emptyFn);
                                latitudeParaPeticion=10.509417;
                                longitudeParaPeticion=-84.421692;
                            }



                            //if(variableSePudoObtenerUbicacionDelPedidor===1){
                            //Se extrae la fecha
                            var fecha2= new Date();
                            //Como se quiere pedir un taxi, se hace la solicitud enviando el pedido y toda
                            //su configuracion con extraparams

                            //alert(latitudeParaPeticion);
                            //alert(longitudeParaPeticion);

                            //Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('idPedido',66);
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('idUsuario',idPerfilUsuarioDidi);
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('latitud',latitudeParaPeticion);
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('longitud',longitudeParaPeticion);
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('tarjeta',Ext.getCmp("toggleTarjeta").getValue());
                            try{
                                Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('descripcion',Ext.getCmp("textAreaAjustesPedidoTaxi").getValue());
                            }
                            catch(e){
                                Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('descripcion',"Nota vacía.");
                            }
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('estado',2);
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('fecha',fecha2);
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('silla',Ext.getCmp("toggleDiversidadFuncional").getValue());
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('mascota',Ext.getCmp("toggleMascotas").getValue());
                            Ext.getStore("storeEnvioSolicitudTaxi").getProxy().setExtraParam('pasajeros',Ext.getCmp("spinnerFieldCantidadPersonas").getValue());
                            Ext.getStore("storeEnvioSolicitudTaxi").load();

                            //Se carga el store, para completar el pedido
                            //Ext.getStore("storeEnvioSolicitudTaxi").load();
                            //Con estas tres lineas se ocultan los botones para configuracion del envio
                            //ya que ya se ha solicitado el taxi
                            Ext.getCmp("containerBotonVolverPosActual").setHidden(1);
                            Ext.getCmp("containerBotonEnviarSolicitud").setHidden(1);
                            Ext.getCmp("containerBotonAjustesPedidoTaxi").setHidden(1);
                            //Con esta linea se hace aparecer el boton que da la opcion de cancelar
                            //el pedido del taxi
                            Ext.getCmp("containerBotonCancelarPedidoTaxi").setHidden(0);    

                            //Se avisa que se ha pedido el taxi
                            Ext.Msg.alert('Taxi solicitado', 'Espere mientras se encuentra un taxi para usted.', Ext.emptyFn);

                            //}
                        },
                        height: '100%',
                        id: 'botonEnviarSolicitud',
                        ui: 'action-round',
                        width: '100%',
                        iconCls: 'action',
                        iconMask: true
                    }
                ]
            },
            {
                xtype: 'container',
                border: 0,
                bottom: '10%',
                height: '10%',
                id: 'containerBotonAjustesPedidoTaxi',
                left: '10%',
                style: 'background: transparent',
                width: '20%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Se despliega el panel, para configurar el pedido
                            Ext.getCmp("panelAjustesPedidoTaxi").setHidden(0);
                        },
                        height: '100%',
                        id: 'botonAjustesPedidoTaxi',
                        ui: 'action-round',
                        width: '100%',
                        iconCls: 'compose',
                        iconMask: true
                    }
                ]
            },
            {
                xtype: 'panel',
                height: '80%',
                hidden: true,
                id: 'panelAjustesPedidoTaxi',
                itemId: 'panelAjustesPedidoTaxi',
                left: '20%',
                top: '10%',
                width: '60%',
                modal: true,
                listeners: [
                    {
                        fn: function(component, options) {
                            //panelAjustesPedidoTaxi=this;
                        },
                        event: 'initialize'
                    }
                ],
                items: [
                    {
                        xtype: 'spinnerfield',
                        height: '10%',
                        id: 'spinnerFieldCantidadPersonas',
                        itemId: 'spinnerFieldCantidadPersonas',
                        right: '5%',
                        top: '52%',
                        width: '90%',
                        maxValue: 14,
                        minValue: 1,
                        stepValue: 1,
                        cycle: true,
                        defaultValue: 4,
                        listeners: [
                            {
                                fn: function(component, options) {
                                    //spinnerFieldCantidadPersonas=this;
                                },
                                event: 'initialize'
                            }
                        ]
                    },
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Se oculta el panel que contiene a este boton
                            Ext.getCmp("panelAjustesPedidoTaxi").setHidden(1);
                            //Se avisa que se han guardado las especificaciones del pedido
                            Ext.Msg.alert('Aviso', 'Especificaciones guardadas.', Ext.emptyFn);
                        },
                        height: '8%',
                        id: 'botonListoPanelAjustesPedidoTaxi',
                        left: '20%',
                        top: '90%',
                        ui: 'confirm',
                        width: '60%',
                        text: 'Listo'
                    },
                    {
                        xtype: 'container',
                        height: '15%',
                        html: '<img src="http://www.castorin.com/img/metodo-pago-tarjeta-de-credito.jpg" width="30%" height="100%">',
                        id: 'containerImagenTarjeta',
                        top: '2%',
                        width: '100%',
                        items: [
                            {
                                xtype: 'togglefield',
                                height: '100%',
                                id: 'toggleTarjeta',
                                itemId: 'toggleTarjeta',
                                right: '0%',
                                width: '60%'
                            }
                        ]
                    },
                    {
                        xtype: 'container',
                        height: '15%',
                        html: '<img src="http://a0.twimg.com/profile_images/2261509965/Minusvalidos_normal.jpg" height="100%" width="30%">',
                        id: 'containerImagenDiversidadFuncional',
                        top: '20%',
                        width: '100%',
                        items: [
                            {
                                xtype: 'togglefield',
                                height: '100%',
                                id: 'toggleDiversidadFuncional',
                                itemId: 'toggleDiversidadFuncional',
                                right: '0%',
                                width: '60%'
                            }
                        ]
                    },
                    {
                        xtype: 'container',
                        height: '15%',
                        html: '<img src="http://profile-a.xx.fbcdn.net/hprofile-prn1/174661_200191673361729_963545762_q.jpg" height="100%" width="30%">',
                        id: 'containerImagenMascota',
                        top: '36%',
                        width: '100%',
                        items: [
                            {
                                xtype: 'togglefield',
                                height: '100%',
                                id: 'toggleMascotas',
                                itemId: 'toggleMascotas',
                                right: '0%',
                                width: '60%'
                            }
                        ]
                    },
                    {
                        xtype: 'textareafield',
                        height: '24%',
                        id: 'textAreaAjustesPedidoTaxi',
                        top: '65%',
                        placeHolder: 'Nota'
                    }
                ]
            },
            {
                xtype: 'container',
                height: '10%',
                hidden: true,
                id: 'containerBotonCancelarPedidoTaxi',
                left: '15%',
                top: '90%',
                width: '70%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con esta linea se hace que aparezca el panel, ya que se ha decidido
                            //no continuar con la solicitud de taxi
                            Ext.getCmp("panelPorQueCanceloPedidoTaxi").setHidden(0);
                            //Con esta linea se oculta el boton de cancelado, que es el que se acaba de
                            //presionar
                            Ext.getCmp("containerBotonCancelarPedidoTaxi").setHidden(1);
                            //Con estas dos lineas, se mandan los parametros necesarios para que en la base
                            //de datos quede registrado que ya no se esta pidiendo taxi por parte de este
                            //usuario
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('idPedido',Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido"));
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('estado',6);
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").load();
                        },
                        id: 'botonCancelarPedidoTaxi',
                        ui: 'decline',
                        text: 'Cancelar'
                    }
                ]
            },
            {
                xtype: 'container',
                height: '10%',
                hidden: true,
                id: 'containerBotonCancelarTaxiEnCamino',
                left: '15%',
                top: '90%',
                width: '70%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con esta linea se hace que aparezca el panel, ya que se ha decidido
                            //no continuar con la solicitud de taxi
                            Ext.getCmp("panelPorQueCanceloTaxiEnCamino").setHidden(0);
                            //Con esta linea se oculta el boton de cancelado, que es el que se acaba de
                            //presionar
                            Ext.getCmp("containerBotonCancelarPedidoTaxi").setHidden(1);
                            //Con esta linea se oculta el boton de cancelado, que es el que se acaba de
                            //presionar
                            Ext.getCmp("containerBotonCancelarTaxiEnCamino").setHidden(1);
                            Ext.getCmp("containerBotonYaRecogieronAlPasajero").setHidden(1);
                            //Con estas dos lineas, se mandan los parametros necesarios para que en la base
                            //de datos quede registrado que ya no se esta pidiendo taxi por parte de este
                            //usuario
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('idPedido',Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido"));
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('estado',6);
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").load();
                        },
                        id: 'botonCancelarTaxiEnCamino',
                        ui: 'decline',
                        text: 'Cancelar'
                    }
                ]
            },
            {
                xtype: 'container',
                height: '10%',
                hidden: true,
                id: 'containerBotonYaRecogieronAlPasajero',
                left: '15%',
                top: '80%',
                width: '70%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con esta linea se oculta el boton de cancelado, que es el que se acaba de
                            //presionar
                            Ext.getCmp("containerBotonCancelarTaxiEnCamino").setHidden(1);
                            Ext.getCmp("containerBotonYaRecogieronAlPasajero").setHidden(1);
                            Ext.getCmp("containerBotonYaTerminoElViaje").setHidden(0);
                            //Con estas dos lineas, se mandan los parametros necesarios para que en la base
                            //de datos quede registrado que ya no se esta pidiendo taxi por parte de este
                            //usuario
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('idPedido',Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido"));
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('estado',4);
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").load();
                        },
                        id: 'botonYaMeRecogieronPedidoTaxi',
                        ui: 'confirm',
                        text: 'Ya pasó por mí'
                    }
                ]
            },
            {
                xtype: 'container',
                height: '10%',
                hidden: true,
                id: 'containerBotonYaTerminoElViaje',
                left: '15%',
                top: '90%',
                width: '70%',
                layout: {
                    type: 'fit'
                },
                items: [
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            Ext.getCmp("containerBotonYaTerminoElViaje").setHidden(1);
                            Ext.getCmp("containerBotonVolverPosActual").setHidden(0);
                            Ext.getCmp("containerBotonEnviarSolicitud").setHidden(0);
                            Ext.getCmp("containerBotonAjustesPedidoTaxi").setHidden(0);
                            //Se pregunta para si se quiere aportar en retroalimentacion
                            extMessageBox=Ext.Msg.confirm('Aviso', 'Quiere contarnos cómo estuvo?.', Ext.emptyFn);
                            //Con estas dos lineas, se mandan los parametros necesarios para que en la base
                            //de datos quede registrado que ya no se esta pidiendo taxi por parte de este
                            //usuario
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('idPedido',Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido"));
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('estado',5);
                            Ext.getStore("storeCambioEstadoSolicitudTaxi").load();
                        },
                        id: 'botonViajeTerminado',
                        ui: 'confirm',
                        text: 'Viaje terminado'
                    }
                ]
            },
            {
                xtype: 'panel',
                height: '80%',
                hidden: true,
                id: 'panelPorQueCanceloPedidoTaxi',
                left: '15%',
                top: '10%',
                width: '70%',
                items: [
                    {
                        xtype: 'titlebar',
                        docked: 'top',
                        id: 'titleBarPanelPorQueCanceloPedidoTaxi',
                        title: 'Por que cancelo?'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox1PanelPorQueCanceloPedidoTaxi',
                        label: 'Duraron mucho.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox2PanelPorQueCanceloPedidoTaxi',
                        label: 'Consegui otra forma.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox3PanelPorQueCanceloPedidoTaxi',
                        label: 'Otro.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con esta linea se oculta el panel en el que se esta, ya que ya se termino de
                            //elegir las razones por las que no quiso continuar con el pedido del taxi
                            Ext.getCmp("panelPorQueCanceloPedidoTaxi").setHidden(1);
                            //Con estas tres lineas se hace que vuelvan a aparecer los tres botones
                            //para lograr el envio de la solicitud de taxi
                            Ext.getCmp("containerBotonVolverPosActual").setHidden(0);
                            Ext.getCmp("containerBotonEnviarSolicitud").setHidden(0);
                            Ext.getCmp("containerBotonAjustesPedidoTaxi").setHidden(0);

                            //AQUI FALTA CODIGO DE RETROALIMENTACION PARA EL CASO DE POR QUE CANCELA TAXI

                        },
                        docked: 'bottom',
                        id: 'botonListoPanelPorQueCanceloPedidoTaxi',
                        ui: 'confirm',
                        text: 'Listo'
                    }
                ]
            },
            {
                xtype: 'panel',
                height: '80%',
                hidden: true,
                id: 'panelPorQueCanceloAceptacionDeTaxi',
                left: '15%',
                top: '10%',
                width: '70%',
                items: [
                    {
                        xtype: 'titlebar',
                        docked: 'top',
                        id: 'titleBarPanelPorQueCanceloAceptacionDeTaxi',
                        title: 'Por que no lo quiere?'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox1PanelPorQueCanceloAceptacionDeTaxi',
                        label: 'Duraron mucho.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox2PanelPorQueCanceloAceptacionDeTaxi',
                        label: 'Consegui otra forma.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox3PanelPorQueCanceloAceptacionDeTaxi',
                        label: 'Otro.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con esta linea se oculta el panel en el que se esta, ya que ya se termino de
                            //elegir las razones por las que no quiso continuar con el pedido del taxi
                            Ext.getCmp("panelPorQueCanceloAceptacionDeTaxi").setHidden(1);
                            //Con estas tres lineas se hace que vuelvan a aparecer los tres botones
                            //para lograr el envio de la solicitud de taxi
                            Ext.getCmp("containerBotonVolverPosActual").setHidden(0);
                            Ext.getCmp("containerBotonEnviarSolicitud").setHidden(0);
                            Ext.getCmp("containerBotonAjustesPedidoTaxi").setHidden(0);

                            //AQUI FALTA CODIGO DE POR QUE SE RECHAZA TAXI DISPONIBLE

                        },
                        docked: 'bottom',
                        id: 'botonListoPanelPorQueCanceloAceptacionDeTaxi',
                        ui: 'confirm',
                        text: 'Listo'
                    }
                ]
            },
            {
                xtype: 'panel',
                height: '80%',
                hidden: true,
                id: 'panelPorQueCanceloTaxiEnCamino',
                left: '15%',
                top: '10%',
                width: '70%',
                items: [
                    {
                        xtype: 'titlebar',
                        docked: 'top',
                        id: 'titleBarPanelPorQueCanceloTaxiEnCamino',
                        title: 'Por que cancelo?'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox1PanelPorQueCanceloTaxiEnCamino',
                        label: 'Duraron mucho.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox2PanelPorQueCanceloTaxiEnCamino',
                        label: 'Consegui otra forma.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'checkboxfield',
                        id: 'checkbox3PanelPorQueCanceloTaxiEnCamino',
                        label: 'Otro.',
                        labelWidth: '70%'
                    },
                    {
                        xtype: 'button',
                        handler: function(button, event) {
                            //Con esta linea se oculta el panel en el que se esta, ya que ya se termino de
                            //elegir las razones por las que no quiso continuar con el pedido del taxi
                            Ext.getCmp("panelPorQueCanceloTaxiEnCamino").setHidden(1);
                            //Con estas tres lineas se hace que vuelvan a aparecer los tres botones
                            //para lograr el envio de la solicitud de taxi
                            Ext.getCmp("containerBotonVolverPosActual").setHidden(0);
                            Ext.getCmp("containerBotonEnviarSolicitud").setHidden(0);
                            Ext.getCmp("containerBotonAjustesPedidoTaxi").setHidden(0);
                        },
                        docked: 'bottom',
                        id: 'botonListoPanelPorQueCanceloTaxiEnCamino',
                        ui: 'confirm',
                        text: 'Listo'
                    }
                ]
            }
        ]
    },

    onContainerInitialize: function(component, options) {
        funcionTrazadoLineaEntreTaxistaYUsuario=function(){
            //aqui es donde se hace uso de storeRefrescadoLatLngPosTaxista
            //alert("feg5ry");
            setTimeout(funcionTrazadoLineaEntreTaxistaYUsuario,1000);//?
        };


        //Esta funcion se llama cuando se ha asociado un taxi
        //al pasajero
        funcionLadoPasajeroTaxiAsociado=function(buttonId){
            if(buttonId=="no"){
                //Con esta linea se hace que aparezca el panel, ya que se ha decidido
                //no continuar con la solicitud de taxi
                Ext.getCmp("panelPorQueCanceloAceptacionDeTaxi").setHidden(0);
                //Con esta linea se oculta el boton de cancelado, que es el que se acaba de
                //presionar
                Ext.getCmp("containerBotonCancelarPedidoTaxi").setHidden(1);
                //Con estas dos lineas, se mandan los parametros necesarios para que en la base
                //de datos quede registrado que ya no se esta pidiendo taxi por parte de este
                //usuario
                Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('idPedido',Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido"));//En vez de 66 aqui va Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido")
                Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('estado',6);
                Ext.getStore("storeCambioEstadoSolicitudTaxi").load();
            }
            else{
                //alert();
                Ext.getCmp("containerBotonCancelarTaxiEnCamino").setHidden(0);
                Ext.getCmp("containerBotonYaRecogieronAlPasajero").setHidden(0);
                Ext.Msg.alert('Aviso', 'Taxi en camino.', Ext.emptyFn);
                //Con estas tres lineas se ocultan los botones para configuracion del envio
                //ya que ya se ha solicitado el taxi
                Ext.getCmp("containerBotonVolverPosActual").setHidden(1);
                Ext.getCmp("containerBotonEnviarSolicitud").setHidden(1);
                Ext.getCmp("containerBotonAjustesPedidoTaxi").setHidden(1);
                //Con esta linea se hace aparecer el boton que da la opcion de cancelar
                //el pedido del taxi
                Ext.getCmp("containerBotonCancelarTaxiEnCamino").setHidden(0);

                //En caso de que el usuario acepte el taxi, se hace un trazado de la linea entre el
                //taxista y el usuario

                funcionTrazadoLineaEntreTaxistaYUsuario();

                Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('idPedido',Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido"));//En vez de 66 aqui va Ext.getStore("storeEnvioSolicitudTaxi").first().get("idPedido")
                Ext.getStore("storeCambioEstadoSolicitudTaxi").getProxy().setExtraParam('estado',3);
                Ext.getStore("storeCambioEstadoSolicitudTaxi").load();


            }
        };
    }

});