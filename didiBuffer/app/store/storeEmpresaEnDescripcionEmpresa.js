/*
 * File: app/store/storeEmpresaEnDescripcionEmpresa.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.1.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.store.storeEmpresaEnDescripcionEmpresa', {
    extend: 'Ext.data.Store',

    requires: [
        'MyApp.model.modelEmpresaEnDescripcionEmpresa'
    ],

    config: {
        model: 'MyApp.model.modelEmpresaEnDescripcionEmpresa',
        storeId: 'storeEmpresaEnDescripcionEmpresa',
        proxy: {
            type: 'jsonp',
            url: 'http://www.didicr.com/php/clienteDescripcion.php',
            reader: {
                type: 'json',
                idProperty: 'idCliente',
                rootProperty: 'ptm'
            }
        },
        listeners: [
            {
                fn: 'onJsonpstoreLoad',
                event: 'load'
            }
        ]
    },

    onJsonpstoreLoad: function(store, records, successful, operation, eOpts) {
        //Cuando se da click en el boton Descripcion para una de las empresas en el listado
        //de las empresas para la subcategoria que se haya elegido, se ejecuta este codigo
        if(botonClickeadoEnListadoTotalEmpresas=="botonParaVerEnMapa"){



            //SE PASA PRIMERO AL MAPA PARA QUE ASI SE CORRA EL MAPRENDER Y NO HAYA PROBLEMAS POR
            //FALTA DEL LATLNG DE LA POSICION ACTUAL O POR FALTA DEL MARKER QUE VA EN LA POSICION
            //ACTUAL
            Ext.getCmp("tabPanelPrincipal").setActiveItem(Ext.getCmp("containerMapaPrincipal"));
            //Este arreglo es para almacenar los RECORDS del store y pasarlo en un arreglo que tenga
            //el unico RECORD, del cual se extrae la informacion para el view Descripcion Empresa
            arregloParaRecordsEnStoreDescEmpresa=[];
            arregloParaRecordsEnStoreDescEmpresa.push(Ext.getStore("storeEmpresaEnDescripcionEmpresa").first());
            //Con este while se borran los pines del mapa si es que habia
            while(markersMapaPrincipal[0]){
                markersMapaPrincipal.pop().setMap(null);
            }
            //Estas instanciaciones son necesarias para lo que se ejecuta en el processStore
            limitesMapaPrincipal = new google.maps.LatLngBounds();
            limitesMapaPrincipal.extend(posActual);
            contadorParaExtraccionDuracionYDistanciaEmpresas=0;
            distanciasHastaEmpresa=[];
            duracionesHastaEmpresas=[];


            //Este retraso es necesario, ya que de las otras 2 maneras de accesar al mapa para poner el
            //pin de una empresa, no son problematicas, ya que se hace un .load() y por lo tanto hay una
            //espera que opaca la eliminacion del uso del currentLocation, pero en este caso de hacerlo
            //desde descripcion empresa, el problema es que no hay un .load() y por lo tanto no hay tal
            //espera que opaque esa eliminacion del uso del currentLocation
            var funcionRetrasoEnLlamadoAlProcessStoreMapaPrincipal = function() {
                var taskPosActual = Ext.create('Ext.util.DelayedTask', function() {
                    //Se llama al processStore para que coloque los pines y luego se oculta el dataView
                    //en la parte inferior del mapaPrincipal
                    Ext.getCmp("mapaContainerMapa").processStore(arregloParaRecordsEnStoreDescEmpresa);
                }, this);
                taskPosActual.delay(500);
            };
            //Esta es la funcion que hace que se refresque la variable que almacena la posicion actual
            funcionRetrasoEnLlamadoAlProcessStoreMapaPrincipal();



            Ext.getCmp("dataViewDidiMapaPrincipalEnTabPanel").setHidden(1);
        }
        else{

            //    alert("fweg");

            //Si no se presiono el botonParaVerEnMapa, entonces el que se presiono y que pudo hacer
            //el .load() aparte de ese es el de ir a Descripcion Empresa
            //    Ext.getCmp("tabPanelPrincipal").setActiveItem(Ext.getCmp("containerDescripcionEmpresa"));

            //Estas lineas se ejecutan cuando se ingresa en el container Descripcion Empresa,
            //a esto se llega desde varios lugares
            //Ext.getCmp("containerTituloDescripcionEmpresa").setHtml("<center><i><b><p style='font-family:serif;color:black;font-size:25px;'>"+records[0].get("nombre")+"</p></b></i><p style='font-family:texgyrechorus;color:black;'>Teléfono: "+records[0].get("telefono")+"</p></center>");
            Ext.getCmp("containerTituloDescripcionEmpresa").setHtml("<p>&nbsp</p><center><i><b><p style='color:black;font-size:25px;'>"+records[0].get("nombre")+"</p></b></i><p style='color:black;'>Teléfono: "+records[0].get("telefono")+"</p></center>");
            Ext.getCmp("imagenPrincipalDescripcionEmpresa").setHtml("<img src="+records[0].get("banner")+" height='100%' width='100%'>");
            Ext.getCmp("containerInfoDescripcionEmpresa").setHtml("<center><p> </p><p> </p><p style='color:black;'>Descripción: "+records[0].get("descripcion")+"</p><p style='color:black;'>Provincia: "+records[0].get("provincia")+"</p><p style='color:black;'>Cantón: "+records[0].get("canton")+"</p></center>");
            //Ext.getCmp("containerInfoDescripcionEmpresa").setHtml("<center><p> </p><p> </p><p style='font-family:texgyrechorus;color:black;'>Descripción: "+records[0].get("descripcion")+"</p><p style='font-family:texgyrechorus;color:black;'>Provincia: "+records[0].get("provincia")+"</p><p style='font-family:texgyrechorus;color:black;'>Cantón: "+records[0].get("canton")+"</p></center>");

            //Este codigo permite verificar si el usuario ya tiene agregado este evento como
            //favorito o no
            Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").getProxy().setUrl("http://www.didicr.com/php/didiFavorito/verificaEmpresaFavoritaUsuario.php");
            Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").getProxy().setExtraParam('idUsuarioParam',idPerfilUsuarioDidi);
            Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").getProxy().setExtraParam('idClienteParam',records[0].get("idCliente"));
            //alert(records[0].get("idEvento"));
            Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").load();
            //Ext.getStore("storeDescripcionEventos").removeAll();
            //La siguiente variable sirve para saber si hay que verificar o no el estado del evento en Favoritos, o lo
            //que es lo mismo, para saber si hay que correr o no el codigo en el Load del store 
            //storeEnvioAgregadoFavoritosPerfilUsuario
            //variableEjecutoCodigoEnStoreAgregadoEventosFavoritos=1;
            //    alert("fae;");

            Ext.getStore("storeModuloDetalleDescripcionEmpresa").getProxy().setExtraParam('idClienteParam',records[0].get('idCliente'));
            Ext.getStore("storeModuloDetalleDescripcionEmpresa").load();
        }



        //Estas lineas se ejecutan cuando se ingresa en el container Descripcion Empresa,
        //a esto se llega desde varios lugares
        //Ext.getCmp("containerTituloDescripcionEmpresa").setHtml("<center><i><b><p style='font-family:serif;color:black;font-size:25px;'>"+records[0].get("nombre")+"</p></b></i><p style='font-family:texgyrechorus;color:black;'>Teléfono: "+records[0].get("telefono")+"</p></center>");
        Ext.getCmp("containerTituloDescripcionEmpresa").setHtml("<p>&nbsp</p><center><i><b><p style='color:black;font-size:25px;'>"+records[0].get("nombre")+"</p></b></i><p style='color:black;'>Teléfono: "+records[0].get("telefono")+"</p></center>");
        Ext.getCmp("imagenPrincipalDescripcionEmpresa").setHtml("<img src="+records[0].get("banner")+" height='100%' width='100%'>");
        Ext.getCmp("containerInfoDescripcionEmpresa").setHtml("<center><p> </p><p> </p><p style='color:black;'>Descripción: "+records[0].get("descripcion")+"</p><p style='color:black;'>Provincia: "+records[0].get("provincia")+"</p><p style='color:black;'>Cantón: "+records[0].get("canton")+"</p></center>");
        //Ext.getCmp("containerInfoDescripcionEmpresa").setHtml("<center><p> </p><p> </p><p style='font-family:texgyrechorus;color:black;'>Descripción: "+records[0].get("descripcion")+"</p><p style='font-family:texgyrechorus;color:black;'>Provincia: "+records[0].get("provincia")+"</p><p style='font-family:texgyrechorus;color:black;'>Cantón: "+records[0].get("canton")+"</p></center>");

        //Este codigo permite verificar si el usuario ya tiene agregado este evento como
        //favorito o no
        Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").getProxy().setUrl("http://www.didicr.com/php/didiFavorito/verificaEmpresaFavoritaUsuario.php");
        Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").getProxy().setExtraParam('idUsuarioParam',idPerfilUsuarioDidi);
        Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").getProxy().setExtraParam('idClienteParam',records[0].get("idCliente"));
        //alert(records[0].get("idEvento"));
        Ext.getStore("storeVerificadoEmpresaFavoritaPerfilUsuario").load();
        //Ext.getStore("storeDescripcionEventos").removeAll();
        //La siguiente variable sirve para saber si hay que verificar o no el estado del evento en Favoritos, o lo
        //que es lo mismo, para saber si hay que correr o no el codigo en el Load del store 
        //storeEnvioAgregadoFavoritosPerfilUsuario
        //variableEjecutoCodigoEnStoreAgregadoEventosFavoritos=1;
        //    alert("fae;");

        Ext.getStore("storeModuloDetalleDescripcionEmpresa").getProxy().setExtraParam('idClienteParam',records[0].get('idCliente'));
        Ext.getStore("storeModuloDetalleDescripcionEmpresa").load();




    }

});